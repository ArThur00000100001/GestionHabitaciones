<div class="container">
    <div class="row mt-5">
        <div class="col-12">
            <div class="card">
                <div class="card-header bg-dark text-white text-center">
                    <div>
                        <h1>Reservas</h1>
                    </div>
                </div>
                <div class="card-body">
                    <div>
                        <button class="btn btn-primary" (click)="data.set({ mode: 'add', item: null })">
                            <i class="bi bi-plus-square"></i> Registrar reserva
                        </button>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th scope="col">#</th>
                                        <th scope="col">ID Habitacion</th>
                                        <th scope="col">Nombre de usuario</th>
                                        <th scope="col">Estado</th>
                                        <th scope="col">Fecha de registro</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @for (item of reservas(); track $index) {
                                    <tr>
                                        <td>{{ item.id }}</td>
                                        <td>
                                            ID: {{ item.habitacion_id }} <br />
                                            Clase: {{ item.habitacion?.tipo_habitacion }} <br />
                                            Pisos: {{ item.habitacion?.piso }}
                                        </td>
                                        <td>{{ item.usuario?.nombres }}</td>
                                        <td>
                                            @if (item.estado == 0){
                                            <span class="bg-success text-white">Libre <i
                                                    class="bi bi-check-lg"></i></span>
                                            }@else if (item.estado == 1) {
                                            <span class="bg-warning text-dark">Reservado <i
                                                    class="bi bi-exclamation-lg"></i></span>
                                            }@else if (item.estado == 2) {
                                            <span class="bg-danger text-white">Ocupado <i class="bi bi-x-lg"></i></span>
                                            }
                                        </td>
                                        <td><span #fecha>{{ item.fecha_registro | date: 'short' | uppercase}} </span></td>
                                        <td>
                                            <!--Boton de elminar
                                            <button type="button" class="btn btn-danger"
                                                (click)="eliminar(item.id, fecha, item.habitacion_id)">
                                                <i class="bi-trash-fill"></i>
                                            </button>-->
                                            -
                                            <button type="button" class="btn btn-primary"
                                                (click)="data.set({ mode: 'edit', item: null })">
                                                <i class="bi-pen"></i>
                                            </button>
                                        </td>
                                    </tr>
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!--Modal-->
@let _data = data(); @if(_data != null){
@let usuario = _data.item;

@if (data()?.mode == 'add') {

<div class="modal d-block" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Crear</h5>
                <button type="button" class="btn-close" (click)="data.set(null)"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-9">
                        <label class="form-label mb-3">Habitacion</label>
                        <select class="form-control mb-3" [ngModel]="idH()" (ngModelChange)="idH.set($event)"
                            (change)="selectHabitacion(estado, btn, select)" #habitacionId>
                            <option value="0" disabled>Habitaciones</option>

                            @for (item of reservas(); track $index) {
                            @if (data()?.mode == 'add') {

                            <option [value]="item.habitacion?.id">
                                ID: {{ item.habitacion?.id }} ------- CLASE:
                                {{ item.habitacion?.tipo_habitacion }} ------- PISO:
                                {{ item.habitacion?.piso }}
                            </option>

                            }@else if (data()?.mode == 'edit') {

                            <option [value]="item.id">
                                ID: {{ item.id }} ------- CLASE:
                                {{ item.habitacion?.tipo_habitacion }} ------- PISO:
                                {{ item.habitacion?.piso }}
                            </option>

                            }

                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        
                        <label class="form-label mb-3">Estado</label>
                        <input class="form-control" type="text" readonly #estado />
                        <select class="form-control" #select>
                            <option value="0">Libre</option>
                            <option value="1">Reservado</option>
                            <option value="2">Ocupado</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <label class="form-label">Usuario</label>
                        <select class="form-control" #userId>
                            <option value="0" disabled>Usuario</option>
                            @for (item of usuarios(); track $index) {
                            <option [value]="item.id">
                                {{ item.nombres }} {{ item.primer_apellido }} {{ item.segundo_apellido }}
                            </option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="data.set(null)">Cancelar</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" #btn
                    (click)="guardar(userId.value, select.value, habitacionId.value); data.set(null)">
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

}@else if (data()?.mode == 'edit') {

<div class="modal d-block" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Editar</h5>
                <button type="button" class="btn-close" (click)="data.set(null)"></button>
            </div>
            <div class="modal-body">
                <div class="row">
                    <div class="col-md-9">
                        <label class="form-label mb-3">Habitacion</label>
                        <select class="form-control mb-3"
                            (change)="selectHabitacion(estado, btn, select)" #habitacionId>
                            <option value="0" disabled>Habitaciones</option>

                            @for (item of reservas(); track $index) {
                            @if (data()?.mode == 'add') {

                            <option [value]="item.habitacion?.id">
                                ID: {{ item.habitacion?.id }} ------- CLASE:
                                {{ item.habitacion?.tipo_habitacion }} ------- PISO:
                                {{ item.habitacion?.piso }}
                            </option>

                            }@else if (data()?.mode == 'edit') {

                            <option [value]="item.habitacion_id">
                                ID: {{ item.id }} ------- CLASE:
                                {{ item.habitacion?.tipo_habitacion }} ------- PISO:
                                {{ item.habitacion?.piso }}
                            </option>

                            }

                            }
                        </select>
                    </div>
                    <div class="col-md-3">
                        <label class="form-label mb-3">Estado</label>
                        <input class="form-control" type="text" readonly #estado />
                        <select class="form-control" #select>
                            <option value="0">Libre</option>
                            <option value="1">Reservado</option>
                            <option value="2">Ocupado</option>
                        </select>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-5">
                        <label class="form-label">Usuario</label>
                        <select class="form-control" #userId>
                            <option value="0" disabled>Usuario</option>
                            @for (item of usuarios(); track $index) {
                            <option [value]="item.id">
                                {{ item.nombres }} {{ item.primer_apellido }} {{ item.segundo_apellido }}
                            </option>
                            }
                        </select>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" (click)="data.set(null)">Cancelar</button>
                <button type="button" class="btn btn-primary" data-bs-dismiss="modal" #btn
                    (click)="guardar(userId.value, select.value, habitacionId.value); data.set(null)">
                    Guardar
                </button>
            </div>
        </div>
    </div>
</div>

}
}